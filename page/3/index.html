<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>乱炖锅 - 以我残躯化作烈火</title><meta name="author" content="NoraH1to"><meta name="copyright" content="NoraH1to"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="以我残躯化作烈火">
<meta property="og:type" content="website">
<meta property="og:title" content="乱炖锅">
<meta property="og:url" content="https://www.norah1to.com/page/3/index.html">
<meta property="og:site_name" content="乱炖锅">
<meta property="og:description" content="以我残躯化作烈火">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.norah1to.com/img/avatar.jpg">
<meta property="article:author" content="NoraH1to">
<meta property="article:tag" content="博客">
<meta property="article:tag" content="NoraH1to">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="emotion">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.norah1to.com/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://www.norah1to.com/page/3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"H8C9SVEHPQ","apiKey":"9e542d4b5b2d39f4bec26306d2eb4034","indexName":"index","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: NoraH1to","link":"链接: ","source":"来源: 乱炖锅","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '乱炖锅',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-12-18 13:00:22'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/main.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">65</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">27</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('/img/cover_index.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">乱炖锅</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">乱炖锅</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="mailto:sterbenlixuan@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://github.com/NoraH1to" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="http://steamcommunity.com/profiles/76561198239304782/" target="_blank" title="Steam"><i class="fa-brands fa-steam"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2022/08/02/front-end-engineering/webpack/plugin/plugin-external-webpack/" title="CDN依赖注入插件"><img class="post_bg" src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CDN依赖注入插件"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/08/02/front-end-engineering/webpack/plugin/plugin-external-webpack/" title="CDN依赖注入插件">CDN依赖注入插件</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-08-02T09:26:00.000Z" title="发表于 2022-08-02 17:26:00">2022-08-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/">工程化</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/webpack/">webpack</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/webpack/%E6%8F%92%E4%BB%B6/">插件</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/webpack/">webpack</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/">工程化</a></span></div><div class="content">
本文参考了：超硬核｜带你畅游在 Webpack 插件开发者的世界

需求有时候我们需要从 CDN 而不是代码中引入依赖，webpack 提供了 external 字段供我们配置
该配置有一个缺点，设置为外部依赖后的包，不知道代码中有没有使用，以防万一我们需要在 index.html 中写 script 标签注入依赖，例如引入 lodash：
123456789101112&lt;!DOCTYPE html&gt;&lt;html&gt;  &lt;head&gt;    &lt;meta charset=&quot;utf-8&quot; /&gt;    &lt;title&gt;Webpack App&lt;/title&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;    &lt;!-- 从 CDN 引入了 lodash --&gt;    &lt;script src=&quot;https://cdnjs.cloud ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/07/28/vue3/source-code/watch/" title="Vue3 源码阅读（7）- watch"><img class="post_bg" src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue3 源码阅读（7）- watch"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/07/28/vue3/source-code/watch/" title="Vue3 源码阅读（7）- watch">Vue3 源码阅读（7）- watch</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-07-28T05:53:00.000Z" title="发表于 2022-07-28 13:53:00">2022-07-28</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/">Vue3</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/%E6%BA%90%E7%A0%81/">源码</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Vue3/">Vue3</a></span></div><div class="content">watch 第三个参数可以传入 options 对象，对象中 flush 属性可以控制回调的更新时机，分别是组件更新前、组件更新后 和 同步触发
从这里得知该 api 与组件渲染有关联，所以其实现不在 @vue/reactivity 里，而是在 @vue/runtime-core 中
具体路径为 packages/runtime-core/src/apiWatch.ts
watch我们跳转到 watch 实现，可以发现其具体实现是 doWatch 方法
1234567891011121314export function watch&lt;T = any, Immediate extends Readonly&lt;boolean&gt; = false&gt;(  source: T | WatchSource&lt;T&gt;,  cb: any,  options?: WatchOptions&lt;Immediate&gt;): WatchStopHandle &#123;  if (__DEV__ &amp;&amp; !isFunction(cb)) &#123;    w ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/07/25/vue3/source-code/computed/" title="Vue3 源码阅读（6）- computed"><img class="post_bg" src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue3 源码阅读（6）- computed"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/07/25/vue3/source-code/computed/" title="Vue3 源码阅读（6）- computed">Vue3 源码阅读（6）- computed</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-07-25T07:42:00.000Z" title="发表于 2022-07-25 15:42:00">2022-07-25</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/">Vue3</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/%E6%BA%90%E7%A0%81/">源码</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Vue3/">Vue3</a></span></div><div class="content">计算属性大家肯定都很熟悉了
其内部实现依赖 effect，追踪到变化后重新计算结果，并且返回的是一个类似 ref 的玩意
其源码在 packages/reactivity/src/computed.ts
computed我们直接定位到方法，可以看到有好几种声明：
123456789101112131415161718// 只传 getterexport function computed&lt;T&gt;(  getter: ComputedGetter&lt;T&gt;,  debugOptions?: DebuggerOptions): ComputedRef&lt;T&gt;// 传一个对象，里面放有 getter 和 setterexport function computed&lt;T&gt;(  options: WritableComputedOptions&lt;T&gt;,  debugOptions?: DebuggerOptions): WritableComputedRef&lt;T&gt;// 实现export function computed&lt;T&g ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/07/20/vue3/source-code/ref/" title="Vue3 源码阅读（5）- ref"><img class="post_bg" src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue3 源码阅读（5）- ref"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/07/20/vue3/source-code/ref/" title="Vue3 源码阅读（5）- ref">Vue3 源码阅读（5）- ref</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-07-20T03:19:00.000Z" title="发表于 2022-07-20 11:19:00">2022-07-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/">Vue3</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/%E6%BA%90%E7%A0%81/">源码</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Vue3/">Vue3</a></span></div><div class="content">ref个人感觉 ref 设计的有些一言难尽，我个人是能用 reactive 的地方绝不用 ref，使用心智负担有点高…解包的行为有点迷
我们看下 ref 的实现：
123export function ref(value?: unknown) &#123;  return createRef(value, false);&#125;

发现调用了 createRef 这个工厂方法：
123456function createRef(rawValue: unknown, shallow: boolean) &#123;  if (isRef(rawValue)) &#123;    return rawValue;  &#125;  return new RefImpl(rawValue, shallow);&#125;

该方法先判断对象是否已经是 ref，是则直接返回其本身，否则返回一个 RefImpl 的实例
RefImpl该类是 ref 的具体实现
成员变量12345678class RefImpl&lt;T&gt; &#123;  private _value: T;  pri ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/07/18/vue3/source-code/effect/" title="Vue3 源码阅读（4）- effect"><img class="post_bg" src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue3 源码阅读（4）- effect"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/07/18/vue3/source-code/effect/" title="Vue3 源码阅读（4）- effect">Vue3 源码阅读（4）- effect</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-07-18T04:30:00.000Z" title="发表于 2022-07-18 12:30:00">2022-07-18</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/">Vue3</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/%E6%BA%90%E7%A0%81/">源码</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Vue3/">Vue3</a></span></div><div class="content">effect 是 @vue/reactivity 包中另外一个非常重要的实现，watchEffect,watch,computed 都是基于这个实现的，该 api 是公开的但是并没有写入文档
effect 就是副作用的意思，其作用很容易理解，我放一段代码：
12345678910111213141516171819&lt;script setup&gt;  import &#123; reactive, watchEffect, effect &#125; from &#x27;vue&#x27;;  const count = reactive(&#123; value: 0 &#125;);  const hello = reactive(&#123; string: &#x27;hello&#x27; &#125;);  effect(() =&gt; console.log(&#x27;count:&#x27;, count.value, &#x27;hello:&#x27;, hello.string));  const add = () =&gt; &#123;    co ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/07/04/vue3/source-code/proxy-handlers/" title="Vue3 源码阅读（3）- ProxyHandlers"><img class="post_bg" src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue3 源码阅读（3）- ProxyHandlers"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/07/04/vue3/source-code/proxy-handlers/" title="Vue3 源码阅读（3）- ProxyHandlers">Vue3 源码阅读（3）- ProxyHandlers</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-07-04T09:54:00.000Z" title="发表于 2022-07-04 17:54:00">2022-07-04</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/">Vue3</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/%E6%BA%90%E7%A0%81/">源码</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Vue3/">Vue3</a></span></div><div class="content">在上一节 reactive 的源码中，我们发现其向 createReactiveObject 函数传入了两个 handler：
1234567return createReactiveObject(  target,  false,  mutableHandlers,  mutableCollectionHandlers,  reactiveMap);

这两个 handler 都是 ProxyHandler 类型，会根据上一节解释过的 TargetType 传给 Proxy 构造函数作为第三个实参：
1234const proxy = new Proxy(  target,  targetType === TargetType.COLLECTION ? collectionHandlers : baseHandlers);

mutableHandlers 和 mutableCollectionHandlers 分别为 baseHandlers.ts,collectionHandlers.ts 暴露的主要监听器
baseHandlers该文件中的 handler 用于处理 Objec ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/07/04/vue3/source-code/reactive/" title="Vue3 源码阅读（2）- reactive"><img class="post_bg" src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue3 源码阅读（2）- reactive"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/07/04/vue3/source-code/reactive/" title="Vue3 源码阅读（2）- reactive">Vue3 源码阅读（2）- reactive</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-07-04T09:54:00.000Z" title="发表于 2022-07-04 17:54:00">2022-07-04</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/">Vue3</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/%E6%BA%90%E7%A0%81/">源码</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Vue3/">Vue3</a></span></div><div class="content">首先我们来看 packages/reactivity/reactive.ts 是如何创建响应式对象的
reactive对外暴露的最常用的接口
12345678910111213export function reactive(target: object) &#123;  // if trying to observe a readonly proxy, return the readonly version.  if (isReadonly(target)) &#123;    return target;  &#125;  return createReactiveObject(    target,    false,    mutableHandlers,    mutableCollectionHandlers,    reactiveMap  );&#125;

最表层的逻辑很简单，判断是否为只读对象
是则返回其本身
否则创建一个响应式对象返回
createReactiveObject 是创建响应式对象的工厂方法，是该文件的核心
createReactiveObject接着 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/07/03/vue3/source-code/basic/" title="Vue3 源码阅读（1）- 前置知识"><img class="post_bg" src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue3 源码阅读（1）- 前置知识"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/07/03/vue3/source-code/basic/" title="Vue3 源码阅读（1）- 前置知识">Vue3 源码阅读（1）- 前置知识</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-07-03T12:34:00.000Z" title="发表于 2022-07-03 20:34:00">2022-07-03</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/">Vue3</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/%E6%BA%90%E7%A0%81/">源码</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Vue3/">Vue3</a></span></div><div class="content">文章是边看源码边写的，建议看文章的同时看源码（不然会看不懂）
知识储备阅读后文需要以下知识储备：

ESNEXT 最新规范

理解 vue2 文档中编写的响应式原理

pnpm 和其 workspace 的使用，了解 pnpm link 指令


本人开发环境
操作系统：Windows11 x64 专业版

IDE：vscode 最新稳定版

调试项目 package.json 依赖版本
12345678910111213&#123;  &quot;dependencies&quot;: &#123;    &quot;vue&quot;: &quot;^3.2.37&quot;  &#125;,  &quot;devDependencies&quot;: &#123;    &quot;@vitejs/plugin-vue&quot;: &quot;^2.3.3&quot;,    &quot;@vitejs/plugin-vue-jsx&quot;: &quot;^1.3.10&quot;,    &quot;sass&quot;: &quot;^1.53.0&quot;,     ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/06/30/front-end-engineering/webpack/plugin/plugin-compress-assets/" title="打包插件"><img class="post_bg" src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="打包插件"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/06/30/front-end-engineering/webpack/plugin/plugin-compress-assets/" title="打包插件">打包插件</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-06-30T07:29:00.000Z" title="发表于 2022-06-30 15:29:00">2022-06-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/">工程化</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/webpack/">webpack</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/webpack/%E6%8F%92%E4%BB%B6/">插件</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/webpack/">webpack</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/">工程化</a></span></div><div class="content">
本文参考了：超硬核｜带你畅游在 Webpack 插件开发者的世界

需求
需要把打包的所有产物压缩到一个 zip 文件中

可以定义文件名


思路
需要找到能获取生成完毕后的文件资源的钩子

遍历所有文件，使用第三方库压缩文件，我们这边使用 jszip


实现
查阅文档可知 emit 为在文件输出前的钩子，该钩子为异步串行钩子，其回调参数为 compilation 对象
compilation 对象能通过 getAssets 函数获得所有的资源数组

我们通过 typescript 类型声明文件发现，asset 对象结构如下


其中的 source 对象结构如下

其中的 source 函数就是我们所需要的

继续查阅文档得知 compilation.emitAsset 方法可以增加输出的文件
其第二个参数 source 对象需要通过 webpack-source 这个库来创建


最后实现的完整代码如下：
123456789101112131415161718192021222324252627282930313233343536373839404142import JSZi ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/06/30/front-end-engineering/webpack/plugin/pre-knowledge/" title="前置知识"><img class="post_bg" src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前置知识"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/06/30/front-end-engineering/webpack/plugin/pre-knowledge/" title="前置知识">前置知识</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-06-30T06:55:00.000Z" title="发表于 2022-06-30 14:55:00">2022-06-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/">工程化</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/webpack/">webpack</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/webpack/%E6%8F%92%E4%BB%B6/">插件</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/webpack/">webpack</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/">工程化</a></span></div><div class="content">TapableTapable 是一个事件发布订阅库，提供了各种同步、异步的事件订阅发布方法
webpack 通过 Tapable 暴露了大量的事件给插件开发者注册，开发者通过这些事件来介入编译打包的过程
学习 Tapable 看这篇文章，写的很好
webpack 插件机制webpack 暴露了非常非常多的 hook 供开发者注册，他们存在于不同的对象上，不同对象的钩子分工明确，涵盖了编译、资源文件等各种场景
看这篇文章，了解插件的开发方式、其大致结构和较常用的几个钩子对象
webpack 钩子文档
compiler（常用）

compilation（常用）

parser（需要处理源码时常用）

resolver


</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/#content-inner">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/#content-inner">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/#content-inner">7</a><a class="extend next" rel="next" href="/page/4/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">NoraH1to</div><div class="author-info__description">以我残躯化作烈火</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">65</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">27</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/11171730/"><i class="fab fa-bilibili"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:sterbenlixuan@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://github.com/NoraH1to" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="http://steamcommunity.com/profiles/76561198239304782/" target="_blank" title="Steam"><i class="fa-brands fa-steam"></i></a></div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/23/basic/javascript/new/" title="new 关键字"><img src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="new 关键字"/></a><div class="content"><a class="title" href="/2022/11/23/basic/javascript/new/" title="new 关键字">new 关键字</a><time datetime="2022-11-23T08:05:00.000Z" title="发表于 2022-11-23 16:05:00">2022-11-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/19/vue3/vuetify/source-code/use-render/" title="Vuetify v3（2）- useRender"><img src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vuetify v3（2）- useRender"/></a><div class="content"><a class="title" href="/2022/11/19/vue3/vuetify/source-code/use-render/" title="Vuetify v3（2）- useRender">Vuetify v3（2）- useRender</a><time datetime="2022-11-19T09:05:00.000Z" title="发表于 2022-11-19 17:05:00">2022-11-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/17/vue3/vuetify/source-code/default-props/" title="Vuetify v3（1）- defineComponent"><img src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vuetify v3（1）- defineComponent"/></a><div class="content"><a class="title" href="/2022/11/17/vue3/vuetify/source-code/default-props/" title="Vuetify v3（1）- defineComponent">Vuetify v3（1）- defineComponent</a><time datetime="2022-11-17T08:07:00.000Z" title="发表于 2022-11-17 16:07:00">2022-11-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/16/basic/css/fc/gfc/" title="栅格格式化上下文(GFC)"><img src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="栅格格式化上下文(GFC)"/></a><div class="content"><a class="title" href="/2022/11/16/basic/css/fc/gfc/" title="栅格格式化上下文(GFC)">栅格格式化上下文(GFC)</a><time datetime="2022-11-16T13:16:00.000Z" title="发表于 2022-11-16 21:16:00">2022-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/16/basic/css/fc/ffc/" title="弹性格式化上下文(FFC)"><img src="/img/cover_post.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="弹性格式化上下文(FFC)"/></a><div class="content"><a class="title" href="/2022/11/16/basic/css/fc/ffc/" title="弹性格式化上下文(FFC)">弹性格式化上下文(FFC)</a><time datetime="2022-11-16T12:45:00.000Z" title="发表于 2022-11-16 20:45:00">2022-11-16</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/leet-code/"><span class="card-category-list-name">leet-code</span><span class="card-category-list-count">10</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/"><span class="card-category-list-name">前端</span><span class="card-category-list-count">38</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/Javascript/"><span class="card-category-list-name">Javascript</span><span class="card-category-list-count">7</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/Javascript/ES6/"><span class="card-category-list-name">ES6</span><span class="card-category-list-count">1</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/Vue2/"><span class="card-category-list-name">Vue2</span><span class="card-category-list-count">3</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/Vue2/tips/"><span class="card-category-list-name">tips</span><span class="card-category-list-count">3</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/"><span class="card-category-list-name">Vue3</span><span class="card-category-list-count">10</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/Vue3/tips/"><span class="card-category-list-name">tips</span><span class="card-category-list-count">3</span></a></li></ul></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/ES6/" style="font-size: 1.1em; color: #999">ES6</a> <a href="/tags/Javascript/" style="font-size: 1.3em; color: #99a1ac">Javascript</a> <a href="/tags/TCP/" style="font-size: 1.1em; color: #999">TCP</a> <a href="/tags/Vue2/" style="font-size: 1.23em; color: #999ea6">Vue2</a> <a href="/tags/Vue3/" style="font-size: 1.43em; color: #99a6b9">Vue3</a> <a href="/tags/Vuetify/" style="font-size: 1.1em; color: #999">Vuetify</a> <a href="/tags/css/" style="font-size: 1.37em; color: #99a4b2">css</a> <a href="/tags/css-in-js/" style="font-size: 1.17em; color: #999c9f">css-in-js</a> <a href="/tags/http/" style="font-size: 1.1em; color: #999">http</a> <a href="/tags/issue/" style="font-size: 1.1em; color: #999">issue</a> <a href="/tags/leet-code/" style="font-size: 1.43em; color: #99a6b9">leet-code</a> <a href="/tags/sass/" style="font-size: 1.23em; color: #999ea6">sass</a> <a href="/tags/vuetify/" style="font-size: 1.17em; color: #999c9f">vuetify</a> <a href="/tags/webpack/" style="font-size: 1.23em; color: #999ea6">webpack</a> <a href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" style="font-size: 1.17em; color: #999c9f">二叉树</a> <a href="/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE/" style="font-size: 1.1em; color: #999">原型链</a> <a href="/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/" style="font-size: 1.1em; color: #999">哈希表</a> <a href="/tags/%E5%A0%86/" style="font-size: 1.23em; color: #999ea6">堆</a> <a href="/tags/%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91/" style="font-size: 1.1em; color: #999">完全二叉树</a> <a href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 1.23em; color: #999ea6">工程化</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.5em; color: #99a9bf">数据结构</a> <a href="/tags/%E6%A0%88/" style="font-size: 1.23em; color: #999ea6">栈</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86/" style="font-size: 1.1em; color: #999">浏览器原理</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.43em; color: #99a6b9">算法</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 1.17em; color: #999c9f">计算机网络</a> <a href="/tags/%E8%BF%90%E7%AE%97%E7%AC%A6/" style="font-size: 1.1em; color: #999">运算符</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size: 1.1em; color: #999">链表</a> <a href="/tags/%E9%98%9F%E5%88%97/" style="font-size: 1.23em; color: #999ea6">队列</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.23em; color: #999ea6">面试</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><span class="card-archive-list-count">15</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">八月 2022</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">七月 2022</span><span class="card-archive-list-count">7</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/06/"><span class="card-archive-list-date">六月 2022</span><span class="card-archive-list-count">22</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/05/"><span class="card-archive-list-date">五月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/04/"><span class="card-archive-list-date">四月 2022</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/03/"><span class="card-archive-list-date">三月 2022</span><span class="card-archive-list-count">9</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/06/"><span class="card-archive-list-date">六月 2021</span><span class="card-archive-list-count">2</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">65</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2021-06-01T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">67.4k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-12-18T05:00:22.039Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By NoraH1to</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    window.typed = new Typed("#subtitle", {
      strings: ["Nameless, Fearless"],
      startDelay: 200,
      typeSpeed: 50,
      loop: false,
      backSpeed: 100
    })
  } else {
    document.getElementById("subtitle").innerHTML = 'Nameless, Fearless'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div><div class="aplayer no-destroy" data-id="7826602140" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false" data-volume="0.1"> </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>